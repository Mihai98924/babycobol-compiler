shared int balance = 500;
shared int iterations = 500;
lock accountAccess;

// === THREADS ADDING 50 ===
fork {
    int i = 0;
    int n = iterations;
    while (i < n) {
        sync accountAccess {
            balance = balance + 50;
            i = i + 1;
        }
    }
}

fork {
    int i = 0;
    int n = iterations;
    while (i < n) {
        sync accountAccess {
            balance = balance + 50;
            i = i + 1;
        }
    }
}

fork {
    int i = 0;
    int n = iterations;
    while (i < n) {
        sync accountAccess {
            balance = balance + 50;
            i = i + 1;
        }
    }
}

// === THREADS TAKING 50 ===
fork {
    int i = 0;
    int n = iterations;
    while (i < n) {
        sync accountAccess {
            balance = balance - 50;
            i = i + 1;
        }
    }
}

fork {
    int i = 0;
    int n = iterations;
    while (i < n) {
        sync accountAccess {
            balance = balance - 50;
            i = i + 1;
        }
    }
}

fork {
    int i = 0;
    int n = iterations;
    while (i < n) {
        sync accountAccess {
            balance = balance - 50;
            i = i + 1;
        }
    }
}

join;
join;
join;
join;
join;
join;

printNL "Expected balance: 500, actual balance:";
print balance;